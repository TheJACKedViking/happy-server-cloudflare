name = "happy-server-workers"
main = "src/index.ts"
compatibility_date = "2025-11-17"
compatibility_flags = ["nodejs_compat"]

# Cloudflare Account ID
account_id = "81f483e6767ea3194467ecef42840f79"

# Enable Node.js compatibility for process.env and other Node APIs
[build]
command = ""

#############################
# Development Environment
#############################
[env.dev]
name = "happy-server-workers-dev"
vars = { ENVIRONMENT = "development" }
# Custom domain routing
routes = [
    { pattern = "happy-api-dev.enflamemedia.com", custom_domain = true }
]

# D1 Database binding (development)
[[env.dev.d1_databases]]
binding = "DB"
database_name = "happy-dev"
database_id = "402f86c0-7405-49cc-9667-93ad06fe4206"
remote = true

# R2 Bucket binding (development)
[[env.dev.r2_buckets]]
binding = "UPLOADS"
bucket_name = "happy-dev-uploads"
remote = true

# Durable Objects bindings (development)
[[env.dev.durable_objects.bindings]]
name = "CONNECTION_MANAGER"
class_name = "ConnectionManager"

# Durable Objects migrations (development) - required for new DO classes
[[env.dev.migrations]]
tag = "v1"
new_classes = ["ConnectionManager"]

[env.dev.observability]
[env.dev.observability.logs]
enabled = true
head_sampling_rate = 1
invocation_logs = true
persist = true

[env.dev.observability.traces]
enabled = true
head_sampling_rate = 1
persist = true

#############################
# Production Environment
#############################
[env.prod]
name = "happy-server-workers-prod"
vars = { ENVIRONMENT = "production" }
# Custom domain routing
routes = [
    { pattern = "happy-api.enflamemedia.com", custom_domain = true }
]

# D1 Database binding (production)
[[env.prod.d1_databases]]
binding = "DB"
database_name = "happy-prod"
database_id = "f547b6d8-035d-4550-a5cf-acea4c533901"
remote = true

# R2 Bucket binding (production)
[[env.prod.r2_buckets]]
binding = "UPLOADS"
bucket_name = "happy-prod-uploads"
remote = true

# Durable Objects bindings (production)
[[env.prod.durable_objects.bindings]]
name = "CONNECTION_MANAGER"
class_name = "ConnectionManager"

# Durable Objects migrations (production) - required for new DO classes
[[env.prod.migrations]]
tag = "v1"
new_classes = ["ConnectionManager"]

[env.prod.observability]
[env.prod.observability.logs]
enabled = true
head_sampling_rate = 1
invocation_logs = true
persist = true

[env.prod.observability.traces]
enabled = true
head_sampling_rate = 1
persist = true